<body><h1>link handle invalid link token </h1><div data-reactroot="" id="__next"><div><aside></aside><div><div tabindex="-1"><main data-algolia="pageContent"><div><div><div><h1>Handling an invalid Link Token</h1><h4>Catch the error in the onExit callback and refetch a new link_token for the next time the user opens Link</h4><div></div></div></div></div><p>Occasionally, the end user may invalidate the existing <code>link_token</code> that was used to open Link by taking too long to go through the flow (30+ minutes), or attempting too many invalid logins. If this happens, Link will exit with an <a href="/docs/errors/invalid-input/#invalid_link_token"><code>INVALID_LINK_TOKEN</code></a> error code.</p><p>To allow your user to open Link again, recognize the error in the <code>onExit</code> callback, fetch a new <code>link_token</code>, and use it to reinitialize Link. You can obtain a new <code>link_token</code> by making another <a href="/docs/api/tokens/#linktokencreate"><code>/link/token/create</code></a> request:</p><span id="content-switcher-unique-id-127">Select group for content switcher</span><div><div aria-labelledby="content-switcher-unique-id-127" role="radiogroup"><button aria-checked="true" role="radio" type="button"><span><span><i><svg aria-hidden="true" role="presentation" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M10.03 17.09l-4.56-4.56 1.06-1.06 3.44 3.44 7.47-8.41 1.12 1-8.53 9.59z" fill="currentColor"></path></svg></i></span><span>Current libraries</span></span></button><button aria-checked="false" role="radio" type="button"><span><span>Legacy libraries</span></span></button></div></div><div><div role="group"><div><label>server.js</label><div><div><div><div><button aria-controls="dropdown-unique-id-128" aria-expanded="false" aria-haspopup="true" aria-label="Select Language" type="button"><span>Node</span><i><svg aria-hidden="true" height="24" role="presentation" width="24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z"></path><path d="M12 14.06l-3.53-3.53 1.06-1.06L12 11.94l2.47-2.47 1.06 1.06z" fill="currentColor"></path></g></svg></i></button></div><div data-popper-escaped="true" data-popper-placement="top" data-popper-reference-hidden="true" role="tooltip"><span>Select Language</span></div></div><div id="dropdown-unique-id-128" role="menu"><ul><li><button aria-current="false" label="Curl" type="button" value="bash"><span><span>Curl</span></span></button></li><li><button aria-current="true" label="Node" type="button" value="node"><span><span>Node</span></span><i><svg aria-hidden="true" role="presentation" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M10.03 17.09l-4.56-4.56 1.06-1.06 3.44 3.44 7.47-8.41 1.12 1-8.53 9.59z" fill="currentColor"></path></svg></i></button></li><li><button aria-current="false" label="Python" type="button" value="python"><span><span>Python</span></span></button></li><li><button aria-current="false" label="Ruby" type="button" value="ruby"><span><span>Ruby</span></span></button></li><li><button aria-current="false" label="Java" type="button" value="java"><span><span>Java</span></span></button></li><li><button aria-current="false" label="Go" type="button" value="go"><span><span>Go</span></span></button></li></ul></div></div><button role="button" type="button"><span><span><span><i><svg aria-hidden="true" role="presentation" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M21.54 11.12l-5.66-5.66a1.24 1.24 0 00-1.76 0l-2.2 2.2-2-2a1.26 1.26 0 00-1.75 0l-5.5 5.5a1.21 1.21 0 000 1.75l5.5 5.5a1.21 1.21 0 001.75 0l2.05-2 2.2 2.2a1.23 1.23 0 001.76 0l5.66-5.66a1.24 1.24 0 00-.05-1.83zM9 17.13L3.87 12 9 6.87l1.85 1.85-2.39 2.4a1.24 1.24 0 000 1.76l2.39 2.4zm6 .17L9.7 12 15 6.7l5.3 5.3z" fill="currentColor"></path></svg></i><i><svg aria-hidden="true" role="presentation" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M10.03 17.09l-4.56-4.56 1.06-1.06 3.44 3.44 7.47-8.41 1.12 1-8.53 9.59z" fill="currentColor"></path></svg></i></span></span><span><span>Copy</span></span></span></button></div></div><div data-id="scroll-container" tabindex="-1"><div><pre><code><div><span>1</span><span>app</span><span>.</span><span>post</span><span>(</span><span>'/api/create_link_token'</span><span>,</span><span> </span><span>async</span><span> </span><span>function</span><span> </span><span>(</span><span>request</span><span>,</span><span> response</span><span>)</span><span> </span><span>{</span><span></span></div><div><span>2</span><span>  </span><span>// Get the client_user_id by searching for the current user</span><span></span></div><div><span>3</span><span>  </span><span>const</span><span> user </span><span>=</span><span> </span><span>await</span><span> </span><span>User</span><span>.</span><span>find</span><span>(</span><span>...</span><span>)</span><span>;</span><span></span></div><div><span>4</span><span>  </span><span>const</span><span> clientUserId </span><span>=</span><span> user</span><span>.</span><span>id</span><span>;</span><span></span></div><div><span>5</span><span>  </span><span>const</span><span> request </span><span>=</span><span> </span><span>{</span><span></span></div><div><span>6</span><span>    user</span><span>:</span><span> </span><span>{</span><span></span></div><div><span>7</span><span>      </span><span>// This should correspond to a unique id for the current user.</span><span></span></div><div><span>8</span><span>      client_user_id</span><span>:</span><span> clientUserId</span><span>,</span><span></span></div><div><span>9</span><span>    </span><span>}</span><span>,</span><span></span></div><div><span>10</span><span>    client_name</span><span>:</span><span> </span><span>'Plaid Test App'</span><span>,</span><span></span></div><div><span>11</span><span>    products</span><span>:</span><span> </span><span>[</span><span>'auth'</span><span>]</span><span>,</span><span></span></div><div><span>12</span><span>    language</span><span>:</span><span> </span><span>'en'</span><span>,</span><span></span></div><div><span>13</span><span>    webhook</span><span>:</span><span> </span><span>'https://webhook.example.com'</span><span>,</span><span></span></div><div><span>14</span><span>    redirect_uri</span><span>:</span><span> </span><span>'https://domainname.com/oauth-page.html'</span><span>,</span><span></span></div><div><span>15</span><span>    country_codes</span><span>:</span><span> </span><span>[</span><span>'US'</span><span>]</span><span>,</span><span></span></div><div><span>16</span><span>  </span><span>}</span><span>;</span><span></span></div><div><span>17</span><span>  </span><span>try</span><span> </span><span>{</span><span></span></div><div><span>18</span><span>    </span><span>const</span><span> createTokenResponse </span><span>=</span><span> </span><span>await</span><span> client</span><span>.</span><span>linkTokenCreate</span><span>(</span><span>request</span><span>)</span><span>;</span><span></span></div><div><span>19</span><span>    response</span><span>.</span><span>json</span><span>(</span><span>createTokenResponse</span><span>.</span><span>data</span><span>)</span><span>;</span><span></span></div><div><span>20</span><span>  </span><span>}</span><span> </span><span>catch</span><span> </span><span>(</span><span>error</span><span>)</span><span> </span><span>{</span><span></span></div><div><span>21</span><span>    </span><span>// handle error</span><span></span></div><div><span>22</span><span>  </span><span>}</span><span></span></div><div><span>23</span><span></span><span>}</span><span>)</span><span>;</span></div></code></pre></div></div></div></div><p>For the Link web integration, reinitializing Link means creating a new iframe. To avoid stacking iframes for each Link initialization, you can clean up the old iframe by calling the <a href="/docs/link/web/#destroy"><code>destroy()</code></a> method on the Plaid Link handler.</p><div role="group"><div><label> </label><div><button role="button" type="button"><span><span><span><i><svg aria-hidden="true" role="presentation" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M21.54 11.12l-5.66-5.66a1.24 1.24 0 00-1.76 0l-2.2 2.2-2-2a1.26 1.26 0 00-1.75 0l-5.5 5.5a1.21 1.21 0 000 1.75l5.5 5.5a1.21 1.21 0 001.75 0l2.05-2 2.2 2.2a1.23 1.23 0 001.76 0l5.66-5.66a1.24 1.24 0 00-.05-1.83zM9 17.13L3.87 12 9 6.87l1.85 1.85-2.39 2.4a1.24 1.24 0 000 1.76l2.39 2.4zm6 .17L9.7 12 15 6.7l5.3 5.3z" fill="currentColor"></path></svg></i><i><svg aria-hidden="true" role="presentation" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M10.03 17.09l-4.56-4.56 1.06-1.06 3.44 3.44 7.47-8.41 1.12 1-8.53 9.59z" fill="currentColor"></path></svg></i></span></span><span><span>Copy</span></span></span></button></div></div><div data-id="scroll-container" tabindex="-1"><div><pre><code><div><span>1</span><span>// Initialize Link with a new link_token each time.</span><span></span></div><div><span>2</span><span></span><span>const</span><span> configs </span><span>=</span><span> </span><span>{</span><span></span></div><div><span>3</span><span>  token</span><span>:</span><span> </span><span>(</span><span>await</span><span> $</span><span>.</span><span>post</span><span>(</span><span>'/create_link_token'</span><span>)</span><span>)</span><span>.</span><span>link_token</span><span>,</span><span></span></div><div><span>4</span><span>  </span><span>onSuccess</span><span>:</span><span> </span><span>(</span><span>public_token</span><span>,</span><span> metadata</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></div><div><span>5</span><span>    </span><span>// Send the public_token to your app server.</span><span></span></div><div><span>6</span><span>  </span><span>}</span><span>,</span><span></span></div><div><span>7</span><span>  </span><span>onExit</span><span>:</span><span> </span><span>(</span><span>err</span><span>,</span><span> metadata</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></div><div><span>8</span><span>    </span><span>// The user exited the Link flow with an INVALID_LINK_TOKEN error.</span><span></span></div><div><span>9</span><span>    </span><span>// This can happen if the token expires or the user has attempted</span><span></span></div><div><span>10</span><span>    </span><span>// too many invalid logins.</span><span></span></div><div><span>11</span><span>    </span><span>if</span><span> </span><span>(</span><span>err </span><span>!=</span><span> </span><span>null</span><span> </span><span>&amp;&amp;</span><span> err</span><span>.</span><span>error_code</span><span> </span><span>===</span><span> </span><span>'INVALID_LINK_TOKEN'</span><span>)</span><span> </span><span>{</span><span></span></div><div><span>12</span><span>      linkHandler</span><span>.</span><span>destroy</span><span>(</span><span>)</span><span>;</span><span></span></div><div><span>13</span><span>      linkHandler </span><span>=</span><span> </span><span>Plaid</span><span>.</span><span>create</span><span>(</span><span>{</span><span></span></div><div><span>14</span><span>        </span><span>...</span><span>configs</span><span>,</span><span></span></div><div><span>15</span><span>        </span><span>// Fetch a new link_token because the old one was invalidated.</span><span></span></div><div><span>16</span><span>        token</span><span>:</span><span> </span><span>(</span><span>await</span><span> $</span><span>.</span><span>post</span><span>(</span><span>'/create_link_token'</span><span>)</span><span>)</span><span>.</span><span>link_token</span><span>,</span><span></span></div><div><span>17</span><span>      </span><span>}</span><span>)</span><span>;</span><span></span></div><div><span>18</span><span>    </span><span>}</span><span></span></div><div><span>19</span><span>    </span><span>// metadata contains the most recent API request ID and the</span><span></span></div><div><span>20</span><span>    </span><span>// Link session ID. Storing this information is helpful</span><span></span></div><div><span>21</span><span>    </span><span>// for support.</span><span></span></div><div><span>22</span><span>  </span><span>}</span><span>,</span><span></span></div><div><span>23</span><span></span><span>}</span><span>;</span><span></span></div><div><span>24</span><span></span></div><div><span>25</span><span></span><span>let</span><span> linkHandler </span><span>=</span><span> </span><span>Plaid</span><span>.</span><span>create</span><span>(</span><span>configs</span><span>)</span><span>;</span></div></code></pre></div></div></div><p>When the user is ready, they will be able to reopen Link and go through the authentication process again.</p></main></div></div></div></div><next-route-announcer><p aria-live="assertive" id="__next-route-announcer__" role="alert"></p></next-route-announcer><div id="batBeacon482039014957"><img alt="" height="0" id="batBeacon499878364519" src="https://bat.bing.com/action/0?ti=25047304&amp;Ver=2&amp;mid=2303b3a1-06ca-41a5-93df-2db2be6bf24c&amp;sid=839d8000406811ee9647031f9910d79d&amp;vid=839d8d20406811ee8b5bc59b5329b4ac&amp;vids=0&amp;msclkid=N&amp;pi=0&amp;lg=en-US&amp;sw=5120&amp;sh=1440&amp;sc=24&amp;nwd=1&amp;tl=Link%20-%20Handling%20an%20invalid%20Link%20Token%20%7C%20Plaid%20Docs&amp;p=https%3A%2F%2Fplaid.com%2Fdocs%2Flink%2Fhandle-invalid-link-token%2F&amp;r=&amp;lt=763&amp;evt=pageLoad&amp;sv=1&amp;rn=86547" width="0"/><img alt="" height="0" id="batBeacon366098348363" src="https://bat.bing.com/action/0?ti=25047304&amp;Ver=2&amp;mid=2303b3a1-06ca-41a5-93df-2db2be6bf24c&amp;sid=839d8000406811ee9647031f9910d79d&amp;vid=839d8d20406811ee8b5bc59b5329b4ac&amp;vids=0&amp;msclkid=N&amp;ea=track&amp;el=DOCS_EVENT&amp;p=https%3A%2F%2Fplaid.com%2Fdocs%2Flink%2Fhandle-invalid-link-token%2F&amp;sw=5120&amp;sh=1440&amp;sc=24&amp;nwd=1&amp;evt=custom&amp;rn=800666" width="0"/></div><div>
</div><img height="1" src="https://t.co/i/adsct?bci=3&amp;eci=2&amp;event_id=f17e34eb-6592-446e-8b09-2be3d4358b02&amp;events=%5B%5B%22pageview%22%2C%7B%7D%5D%5D&amp;integration=advertiser&amp;p_id=Twitter&amp;p_user_id=0&amp;pl_id=6fc8ca64-b5e1-4ed8-85f3-1057ae01e65d&amp;tw_document_href=https%3A%2F%2Fplaid.com%2Fdocs%2Flink%2Fhandle-invalid-link-token%2F&amp;tw_iframe_status=0&amp;tw_order_quantity=0&amp;tw_sale_amount=0&amp;txn_id=o5pi2&amp;type=javascript&amp;version=2.3.29" width="1"/><img height="1" src="https://analytics.twitter.com/i/adsct?bci=3&amp;eci=2&amp;event_id=f17e34eb-6592-446e-8b09-2be3d4358b02&amp;events=%5B%5B%22pageview%22%2C%7B%7D%5D%5D&amp;integration=advertiser&amp;p_id=Twitter&amp;p_user_id=0&amp;pl_id=6fc8ca64-b5e1-4ed8-85f3-1057ae01e65d&amp;tw_document_href=https%3A%2F%2Fplaid.com%2Fdocs%2Flink%2Fhandle-invalid-link-token%2F&amp;tw_iframe_status=0&amp;tw_order_quantity=0&amp;tw_sale_amount=0&amp;txn_id=o5pi2&amp;type=javascript&amp;version=2.3.29" width="1"/><iframe height="0" id="universal_pixel_u0iai2i" src="https://insight.adsrvr.org/track/up?adv=4azo4ri&amp;ref=https%3A%2F%2Fplaid.com%2Fdocs%2Flink%2Fhandle-invalid-link-token%2F&amp;upid=u0iai2i&amp;upv=1.1.0" title="TTD Universal Pixel" width="0"></iframe><img height="1" src="https://t.co/i/adsct?bci=3&amp;eci=2&amp;event_id=95a46730-b985-4595-9c7b-ada188def73b&amp;events=%5B%5B%22pageview%22%2C%7B%7D%5D%5D&amp;integration=advertiser&amp;p_id=Twitter&amp;p_user_id=0&amp;pl_id=6fc8ca64-b5e1-4ed8-85f3-1057ae01e65d&amp;tw_document_href=https%3A%2F%2Fplaid.com%2Fdocs%2Flink%2Fhandle-invalid-link-token%2F&amp;tw_iframe_status=0&amp;tw_order_quantity=0&amp;tw_sale_amount=0&amp;txn_id=o5pi2&amp;type=javascript&amp;version=2.3.29" width="1"/><img height="1" src="https://analytics.twitter.com/i/adsct?bci=3&amp;eci=2&amp;event_id=95a46730-b985-4595-9c7b-ada188def73b&amp;events=%5B%5B%22pageview%22%2C%7B%7D%5D%5D&amp;integration=advertiser&amp;p_id=Twitter&amp;p_user_id=0&amp;pl_id=6fc8ca64-b5e1-4ed8-85f3-1057ae01e65d&amp;tw_document_href=https%3A%2F%2Fplaid.com%2Fdocs%2Flink%2Fhandle-invalid-link-token%2F&amp;tw_iframe_status=0&amp;tw_order_quantity=0&amp;tw_sale_amount=0&amp;txn_id=o5pi2&amp;type=javascript&amp;version=2.3.29" width="1"/></body>